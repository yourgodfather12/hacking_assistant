import subprocess
import logging
from config import OPENVAS_CMD

logger = logging.getLogger(__name__)

def scan_target(target: str) -> str:
    """Run a vulnerability scan on the target using OpenVAS."""
    try:
        result = subprocess.run([OPENVAS_CMD, "--target", target], capture_output=True, text=True, check=True, timeout=600)
        logger.info(f"Vulnerability scan completed for target {target}.")
        return result.stdout
    except subprocess.CalledProcessError as e:
        logger.error(f"OpenVAS command failed for target {target}: {e}")
        return f"An error occurred: {e.output}"
    except subprocess.TimeoutExpired:
        logger.error(f"OpenVAS command timed out for target {target}.")
        return "Error: Command timed out."
    except Exception as e:
        logger.error(f"Unexpected error during vulnerability scan of {target}: {e}")
        return f"Unexpected error: {e}"
